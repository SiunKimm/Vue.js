<!DOCTYPE html>
<html lang="kr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Vue3 To-do List</title>
    <script src="https://unpkg.com/vue@3.2"></script>

    <style>
        .work {
            outline: none;
            background: none;
            border: 0 none;
            font-size: 22px;
        }

        .check {
            text-decoration: line-through;
            color: green;
        }
    </style>
</head>

<body>
    <h1 class="tdl">To Do List</h1>
    <div class="app-list" id="app">
        <!-- í•„í„°ë¥¼ í†µí•˜ì—¬ ì „ì²´, ì™„ë£Œ, ë¯¸ì™„ë£Œ ë°ì´í„°ë¥¼ êµ¬ë¶„ -->
        <button class="filter" :class="{filterActive: filter == 'all'}" @click="filter = 'all' ">All</button>&nbsp;
        <button class="filter" :class="{filterActive: filter == 'complete'}" @click="filter = 'complete' ">Done</button>&nbsp;
        <button class="filter" :class="{filterActive: filter == 'undone'}" @click="filter = 'undone' ">Undone</button>&nbsp;
        <!-- í¼ì˜ ê¸°ë³¸ì ì¸ ë™ì‘ì„ ë§‰ê¸°ìœ„í•œ modifier / ìƒˆë¡œê³ ì¹¨ ë°©ì§€ -->
        <form @submit.prevent="addWork">
            <br>
            <!-- v-if ë¬¸ì„ í†µí•˜ì—¬ editingWork.isEdit ì´ true ê°€ ë˜ë©´ input v-model ì´ ë³€ê²½ë˜ë©° ë…¸ì¶œ -->
            <div v-if="editingWork.isEdit == true">
                <input v-model="editingWork.attribute" class="input-work">
                &nbsp;<button class="edit" @click="completeEdit(editingWork.index)">
                    âœ…
                </button>
                <button class="edit-cancel" @click="cancelEdit(editingWork.index)">
                    âŒ
                </button>
            </div>
            <!-- v-else ë¬¸ì„ í†µí•˜ì—¬ v-if true ê°€ ì•„ë‹ì‹œì— ê¸°ë³¸ì ìœ¼ë¡œ inputWork ë…¸ì¶œ ë° ì‘ë™ -->
            <!-- ë°ì´í„° ì…ë ¥ input box -->
            <div v-else>
                <input v-model="inputWork" class="input-work" placeholder="Add a new task">
                &nbsp;<button class="add" type="submit">ADD</button>
            </div>
        </form>
        <ul>
            <!-- í…ìŠ¤íŠ¸ëŠ” ìœ ì§€ ë° ë°ì´í„° ì°¾ì•„ë‚´ì–´ listFilter ê°’ ë°˜ë³µ ë…¸ì¶œ -->
            <!-- v-for="<ìš”ì†Œ> in <ë°°ì—´ ë˜ëŠ” ê°ì²´>" -->
            <li v-for="(work, index ) in listFilter">
                <div>
                    <!-- í´ë¦­í•œ index ê°€ done ë©”ì†Œë“œë¥¼ ì‘ë™í•˜ì—¬ complete ìƒíƒœê°€ true ë¡œ ë³€ê²½ -->
                    <button @click="done(index)" class="work" v-bind:class="{check: work.complete}">
                        <i class="fa fa-check " v-bind:class="{active: work.complete }"></i>{{work.attribute}}
                    </button>
                    <!-- ë“±ë¡ ì‹œê°„ -->
                    <td>{{ work.create }}</td>
                </div>

                <!-- ê¸°ì¡´ ì½”ë“œ
                <div v-if="work.isEdit">
                    <input v-model="work.attribute" type="text">
                </div>				
                <div v-else>
                    <button @click="done(index)" class="work" v-bind:class="{check: work.complete}">
                        <i class="fa fa-check " v-bind:class="{active: work.complete }"></i>{{work.attribute}}
                    </button>
                    <td>{{ work.create }}</td>
                </div>
				-->
                
                <!-- í´ë¦­í•œ index ê°€ remove ë©”ì„œë“œë¥¼ ì‘ë™ -->
                <button class="delete" @click="remove(index)">
                    ğŸ—‘ï¸
                </button>
                <!-- í´ë¦­í•œ index ê°€ startEdit ë©”ì„œë“œë¥¼ ì‘ë™ -->
                <button v-else class="edit" @click="startEdit(index)">
                    âœï¸
                </button>

                <!--
                <div v-if="work.isEdit">
                    
                </div>
				-->
            </li>
        </ul>
        <hr>
        <!-- done ìƒíƒœê°€ ì•„ë‹Œ index ì˜ ìˆ˜ëŸ‰ì„ í‘œì‹œ -->
        <div class="remain">Todo: {{remain}}ê°œ ë‚¨ìŒ</div>
        <br>
        <!-- ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ allRemove ë©”ì„œë“œë¥¼ ì‘ë™í•˜ì—¬ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ë°ì´í„° ì‚­ì œ & View ë…¸ì¶œë˜ëŠ” ë°ì´í„° splice ë©”ì„œë“œë¡œ ì‚­ì œ -->
        <!-- splice ë©”ì„œë“œë€? ë°°ì—´ì˜ ê¸°ì¡´ ìš”ì†Œë¥¼ ì‚­ì œ ë˜ëŠ” êµì²´í•˜ê±°ë‚˜ ìƒˆ ìš”ì†Œë¥¼ ì¶”ê°€í•˜ì—¬ ë°°ì—´ì˜ ë‚´ìš©ì„ ë³€ê²½ -->
        <button class="allRemove" @click="allRemove(index),list.splice(index);">
            <i class="far fa-trash-alt">ì „ì²´ ì‚­ì œë‹¤!</i>
        </button>
    </div>

    <script>
        
        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ë¥¼ ë³€ìˆ˜ë¡œ ì„ ì–¸
        var STORAGE_KEY = 'vue3-todo-localStorage'
        // ë°°ì—´ì„ fetch í•¨ìˆ˜ë¥¼ í†µí•´ì„œ list ì„ ì–¸í›„ JSON í˜•ì‹ìœ¼ë¡œ localStorage.getItem ëª…ë ¹ì–´ë¥¼ í†µí•´ì„œ ê°€ì ¸ì˜¨ ì´í›„ list ë¡œ ë¦¬í„´
        var listStorage = {
            fetch() {
                var list = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
                console.log("ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ë¡œë“œ")
                return list;
            },
            // save í•¨ìˆ˜ë¥¼ í†µí•´ì„œ ë¦¬í„´ë°›ì€ list ë¥¼ localStorage.setItem ëª…ë ¹ì–´ë¥¼ í†µí•´ì„œ JSON í˜•ì‹ìœ¼ë¡œ ì €ì¥
            save(list) {
                console.log("ë°ì´í„° ë³€ê²½ ê°ì§€")
                localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
            }
        }
        
        
        // Vue3 CDN ë°©ì‹ì—ì„œ import ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•˜ì—¬ ë°°ì—´ êµ¬ì¡°ì˜ const ìƒìˆ˜ë“¤ë¡œ ì„ ì–¸í•˜ì—¬ ê°ê°ì˜ ê¸°ëŠ¥ì´ ì‘ë™í•˜ë„ë¡ import
        const { createApp, computed, defineComponent, ref, reactive, watch } = Vue

        // createApp ì„ í†µí•´ì„œ Vue app ìƒì„±
        var app = createApp(defineComponent({
            setup() {
                // ìˆ˜ì •ì¤‘ì¸ index ë³€ìˆ˜ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
                // editingWork : ìˆ˜ì •ì¤‘ì¸ ë°ì´í„°ì˜ index ë³€ìˆ˜ ìƒì„±
                const editingWork = reactive({
                    index: -1,
                    isEdit: false,
                    attribute: '',
                })

                // ref : ë·° í…œí”Œë¦¿ì˜ DOM ë˜ëŠ” ì»´í¬ë„ŒíŠ¸ë¥¼ ê°€ë¦¬í‚¤ëŠ” ì†ì„± -> reactive reference ë°˜ì‘í˜• ë°ì´í„°ë¥¼ ì˜ë¯¸ë¡œ ë³€ê²½
                const inputWork = ref('') // ë°ì´í„° ì¶”ê°€
                const newId = ref(0) // ë°ì´í„°ì˜ ID
                const filter = ref('all') // ë°ì´í„°ì˜ í•„í„°
                const list = ref(listStorage.fetch()) // ë°ì´í„°ë¥¼ ë‹´ì•„ë‘ëŠ” ë°°ì—´
                const remain = computed(() => list.value.filter(work => !work.complete).length) // work.complete ì˜ ê¸¸ì´ë¥¼ í†µí•´ì„œ ë‚¨ì€ í•  ì¼ ê°¯ìˆ˜ í‘œì‹œ
                const listFilter = computed(() => { // computed ë¥¼ í†µí•´ì„œ listFilter, if all, ê·¸ ì™¸ ì¡°ê±´ì— ë”°ë¼ì„œ undone / complete
                    if (filter.value == 'all') {
                        return list.value
                    } else if (filter.value == 'undone') {
                        return list.value.filter(work => !work.complete)
                    } else if (filter.value == 'complete') {
                        return list.value.filter(work => work.complete)
                    }
                    return list.value // ê·¸ í›„ list ì˜ value ë¡œ ë¦¬í„´
                })

                // Add ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì‘ë™í•˜ëŠ” ë©”ì„œë“œ, new Date ë¥¼ í†µí•´ì„œ í˜„ì¬ ì‹œê°„ì„ todate ë¡œ ë³€ìˆ˜ ì„ ì–¸
                // list.value ì˜ concat / filter ê°™ì€ ë¦¬ìŠ¤íŠ¸ ë Œë”ë§ì„ ì˜ë¯¸
                // ê° ë°ì´í„°ì˜ ì˜ë¯¸ëŠ” ë‹¤ìŒê³¼ ê°™ìŒ
                const addWork = () => {
                    if (inputWork.value) {
                        let todate = new Date(+new Date() + 3240 * 10000).toISOString().replace("T", " ").replace(/\..*/, '');
                        list.value = list.value.concat({
                            id: newId.value++, // ìƒˆë¡œìš´ ë°ì´í„°ì˜ id ëŠ” newId ì˜ value ê°€ ìˆœì°¨ì ìœ¼ë¡œ ì¦ê°€
                            attribute: inputWork.value, // ê°ì²´ê°€ ë‹´ê³ ìˆëŠ” ë‚´ìš©
                            complete: false, // ê°ì²´ê°€ ì„±ê³µí–ˆëŠ”ì§€ complete ì¡°ê±´ì„ true/false ì¡°ê±´ì„ í†µí•˜ì—¬ ë¶„ë¦¬
                            create: todate // ìƒì„± ì‹œê°„
                        });
                    }
                    // input í•˜ëŠ” ìˆœê°„ box ì•ˆì— ìˆëŠ” ë°ì´í„°ê°€ ì‚¬ë¼ì§€ê²Œ í•¨
                    inputWork.value = '';
                }

                // const complete = (work) => {
                //     work.complete = !work.complete;
                // }

                // list ë¥¼ ë³€ê²½í•  ë•ŒëŠ” Vue2 ì™€ëŠ” ë‹¬ë¦¬ list ì „ì²´ë¥¼ ìƒˆë¡œìš´ list ë¡œ ëŒ€ì²´
                // done & remove í•¨ìˆ˜

                // ê°ì²´ì˜ index ì£¼ì†Œê°’ì„ ì°¾ì•„ì„œ complte ìƒíƒœë¥¼ ë³€ê²½í•œ ì´í›„ì— work ë¡œ ë¦¬í„´
                const done = (index) => {
                    // work.complete = !work.complete;
                    list.value = list.value.map((work, i) => {
                        if (i === index) work.complete = !work.complete;
                        return work
                    })
                }

                // ê°ì²´ì˜ index ì£¼ì†Œê°’ì„ ì°¾ì•„ì„œ filter ë¥¼ í†µí•´ì„œ ë“œëŸ¬ëƒ„ -> ì‚­ì œ
                const remove = (index) => {
                    list.value = list.value.filter((_, i) => i !== index)
                }

                // ìˆ˜ì •ë˜ê³  ìˆëŠ” ê°ì²´ë¥¼ editingWork ë¼ëŠ” ìƒíƒœë¥¼ ê°€ì§€ê³  ìˆëŠ” index, attribute, isEdit ë¡œ ì„ ì–¸
                // index ë¥¼ í†µí•˜ì—¬ ë°ì´í„°ê°€ ì„ íƒë˜ê³ , attribute ë¥¼ í†µí•˜ì—¬ í•´ë‹¹ ë°ì´í„°ê°€ ìƒë‹¨ ì¸í’‹ë°•ìŠ¤ë¡œ, isEdit ë¥¼ í†µí•´ ìˆ˜ì •ì¤‘ì¸ì§€ í™•ì¸
                const setEditState = (index, work) => {
                    editingWork.index = index
                    editingWork.attribute = work.attribute
                    editingWork.isEdit = work.isEdit
                }

                // ìˆ˜ì • ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ isEdit ê°€ true ë¡œ ë³€í™˜í•˜ë©´ì„œ í˜„ì¬ ë°ì´í„°ê°€ -> ìˆ˜ì • ë°•ìŠ¤ ë°ì´í„°ë¡œ -> ê·¸ í›„ì— setEditState ë¥¼ í†µí•˜ì—¬ ë³€ê²½ ì‘ì—… ì‹œì‘
                const startEdit = (index) => {
                    list.value = list.value.map((work, i) => {
                        if (i === index) {
                            work.isEdit = true
                            work.orgAttribute = work.attribute
                            setEditState(index, work)
                        }
                        return work
                    })
                }
                
                // isEdit ê°€ false ë¡œ ë³€í™˜í•˜ê³  ì•„ë¬´ì¼ë„ ì¼ì–´ë‚˜ì§€ ì•ŠìŒ, ì•„ë˜ ë©”ì„œë“œì™€ ì°¨ì´ì ì€ work.orgAttribute
                const cancelEdit = (index) => {
                    list.value = list.value.map((work, i) => {
                        if (i === index) {
                            work.isEdit = false
                            work.attribute = work.orgAttribute
                            setEditState(index, work)
                        }
                        return work
                    })
                }

                // ì¦‰ í˜„ì¬ ë°ì´í„°ì¸ work ê°€ ì•„ë‹Œ edtingWork ì˜ ë°ì´í„°ê°€ ì¦‰ work ë°ì´í„°ë¡œ ë³€í™˜ë˜ë©´ì„œ ì €ì¥ì†Œì— ì €ì¥ë¨
                const completeEdit = (index) => {
                    list.value = list.value.map((work, i) => {
                        if (i === index) {
                            work.isEdit = false
                            work.attribute = editingWork.attribute
                            setEditState(index, work)
                        }
                        return work
                    })
                }

                // ì „ì²´ ì‚­ì œ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì‹œì‘í•˜ëŠ” ë©”ì„œë“œ, ë¡œì»¬ìŠ¤í† ë¦¬ì§€ë¥¼ í´ë¦¬ì–´í•˜ê³  newId ì˜ ê°’ì„ 0 ìœ¼ë¡œ ì´ˆê¸°í™”
                const allRemove = (index) => {
                    localStorage.clear();
                    id: newId.value = 0;
                }

                // watch ë¥¼ í†µí•˜ì—¬ ë°ì´í„°ê°€ ì‹¤ì§ˆì ìœ¼ë¡œ ë³€ê²½ë˜ëŠ”ì§€ í™•ì¸
                // Vue3 ì—ì„œ ê¸°ë³¸ì ìœ¼ë¡œ Swallow ë°©ì‹ìœ¼ë¡œ êµ¬í˜„, ë¦¬ìŠ¤íŠ¸ì— ë°ì´í„°ê°€ ì¶”ê°€ë˜ì–´ë„ ë³€ìˆ˜ì˜ ë©”ëª¨ë¦¬ì— ë³€ê²½ì´ ê°€í•´ì§€ì§€ ì•Šì•„ì„œ watch íŒë‹¨ ë¶ˆê°€
                // deep ì˜µì…˜ì„ í†µí•´ì„œ ë°ì´í„°ì— ë³€í™”ê°€ ìˆì—ˆëŠ”ì§€ í™•ì¸
                watch(() => list.value, (list) => {
                    listStorage.save(list);
                } // deep: true, handler ì™€ deep ì€ ê°™ì€ depth
                  // Vue2 ì—ì„œ object ë° array ì˜ ê°’ ì¶”ì (observation) ë¶ˆì™„ì „í•˜ì—¬ Vue3 í¬ë§·ìœ¼ë¡œ ì‘ì„±ë˜ë©° deep ì‚­ì œ
                )

                return {
                    editingWork, // ìˆ˜ì •ì¤‘ì¸ ë°ì´í„°
                    inputWork, // ë°ì´í„° inputBox
                    newId, // ë°ì´í„°ì˜ Id
                    filter, // ë°ì´í„°ì˜ ìƒíƒœ
                    list, // ë°ì´í„°ê°€ ë‹´ê¸´ ë°°ì—´
                    remain, // ë°ì´í„°ì˜ ìƒíƒœì— ë”°ë¼ì„œ ê°¯ìˆ˜ë¥¼ êµ¬ë¶„
                    listFilter, // ë°ì´í„°ì˜ ìƒíƒœì— ë”°ë¼ì„œ ë¦¬ìŠ¤íŠ¸ë¥¼ êµ¬ë¶„
                    addWork, // ë°ì´í„° ì‚½ì…
                    done, // ë°ì´í„°ì˜ ìƒíƒœ, done
                    remove, // ë°ì´í„° ì‚­ì œ
                    startEdit, // ìˆ˜ì • ì‹œì‘ê³¼ View ë³€í™”
                    cancelEdit, // ìˆ˜ì • ì·¨ì†Œ
                    completeEdit, // ìˆ˜ì • ë°ì´í„° ì‚½ì…
                    allRemove, // ì „ì²´ ë°ì´í„° ì‚­ì œ
                }
            }
        }))

        app.mount('#app') // Vue3 app ì—°ê²°

    </script>
</body>

</html>