<!DOCTYPE html>
<html lang="kr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Vue3 To-do List</title>
    <script src="https://unpkg.com/vue@3.2"></script>

    <style>
        .work {
            outline: none;
            background: none;
            border: 0 none;
            font-size: 22px;
        }

        .check {
            text-decoration: line-through;
            color: green;
        }
    </style>
</head>

<body>
    <h1 class="tdl">To Do List</h1>
    <div class="app-list" id="app">
        <!-- ÌïÑÌÑ∞Î•º ÌÜµÌïòÏó¨ Ï†ÑÏ≤¥, ÏôÑÎ£å, ÎØ∏ÏôÑÎ£å Îç∞Ïù¥ÌÑ∞Î•º Íµ¨Î∂Ñ -->
        <button class="filter" :class="{filterActive: filter == 'all'}" @click="filter = 'all' ">All</button>&nbsp;
        <button class="filter" :class="{filterActive: filter == 'complete'}" @click="filter = 'complete' ">Done</button>&nbsp;
        <button class="filter" :class="{filterActive: filter == 'undone'}" @click="filter = 'undone' ">Undone</button>&nbsp;
        <!-- ÌèºÏùò Í∏∞Î≥∏Ï†ÅÏù∏ ÎèôÏûëÏùÑ ÎßâÍ∏∞ÏúÑÌïú modifier / ÏÉàÎ°úÍ≥†Ïπ® Î∞©ÏßÄ -->
        <form @submit.prevent="addWork">
            <br>
            <!-- v-if Î¨∏ÏùÑ ÌÜµÌïòÏó¨ editingWork.isEdit Ïù¥ true Í∞Ä ÎêòÎ©¥ input v-model Ïù¥ Î≥ÄÍ≤ΩÎêòÎ©∞ ÎÖ∏Ï∂ú -->
            <div v-if="editingWork.isEdit == true">
                <input v-model="editingWork.attribute" class="input-work">
                &nbsp;<button class="edit" @click="completeEdit(editingWork.index)">
                    ‚úÖ
                </button>
                <button class="edit-cancel" @click="cancelEdit(editingWork.index)">
                    ‚ùå
                </button>
            </div>
            <!-- v-else Î¨∏ÏùÑ ÌÜµÌïòÏó¨ v-if true Í∞Ä ÏïÑÎãêÏãúÏóê Í∏∞Î≥∏Ï†ÅÏúºÎ°ú inputWork ÎÖ∏Ï∂ú Î∞è ÏûëÎèô -->
            <!-- Îç∞Ïù¥ÌÑ∞ ÏûÖÎ†• input box -->
            <div v-else>
                <input v-model="inputWork" class="input-work" placeholder="Add a new task">
                &nbsp;<button class="add" type="submit">ADD</button>
            </div>
        </form>
        <ul>
            <!-- ÌÖçÏä§Ìä∏Îäî Ïú†ÏßÄ Î∞è Îç∞Ïù¥ÌÑ∞ Ï∞æÏïÑÎÇ¥Ïñ¥ listFilter Í∞í Î∞òÎ≥µ ÎÖ∏Ï∂ú -->
            <!-- v-for="<ÏöîÏÜå> in <Î∞∞Ïó¥ ÎòêÎäî Í∞ùÏ≤¥>" -->
            <li v-for="(work, index ) in listFilter">
                <div>
                    <!-- ÌÅ¥Î¶≠Ìïú index Í∞Ä done Î©îÏÜåÎìúÎ•º ÏûëÎèôÌïòÏó¨ complete ÏÉÅÌÉúÍ∞Ä true Î°ú Î≥ÄÍ≤Ω -->
                    <button @click="done(index)" class="work" v-bind:class="{check: work.complete}">
                        <i class="fa fa-check " v-bind:class="{active: work.complete }"></i>{{work.attribute}}
                    </button>
                    <!-- Îì±Î°ù ÏãúÍ∞Ñ -->
                    <td>{{ work.create }}</td>
                </div>

                <!-- Í∏∞Ï°¥ ÏΩîÎìú
                <div v-if="work.isEdit">
                    <input v-model="work.attribute" type="text">
                </div>				
                <div v-else>
                    <button @click="done(index)" class="work" v-bind:class="{check: work.complete}">
                        <i class="fa fa-check " v-bind:class="{active: work.complete }"></i>{{work.attribute}}
                    </button>
                    <td>{{ work.create }}</td>
                </div>
				-->
                
                <!-- ÌÅ¥Î¶≠Ìïú index Í∞Ä remove Î©îÏÑúÎìúÎ•º ÏûëÎèô -->
                <button class="delete" @click="remove(index)">
                    üóëÔ∏è
                </button>
                <!-- ÌÅ¥Î¶≠Ìïú index Í∞Ä startEdit Î©îÏÑúÎìúÎ•º ÏûëÎèô -->
                <button v-else class="edit" @click="startEdit(index)">
                    ‚úèÔ∏è
                </button>

                <!--
                <div v-if="work.isEdit">
                    
                </div>
				-->
            </li>
        </ul>
        <hr>
        <!-- done ÏÉÅÌÉúÍ∞Ä ÏïÑÎãå index Ïùò ÏàòÎüâÏùÑ ÌëúÏãú -->
        <div class="remain">Todo: {{remain}}Í∞ú ÎÇ®Ïùå</div>
        <br>
        <!-- Î≤ÑÌäºÏùÑ ÎàÑÎ•¥Î©¥ allRemove Î©îÏÑúÎìúÎ•º ÏûëÎèôÌïòÏó¨ Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄ Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú & View ÎÖ∏Ï∂úÎêòÎäî Îç∞Ïù¥ÌÑ∞ splice Î©îÏÑúÎìúÎ°ú ÏÇ≠Ï†ú -->
        <!-- splice Î©îÏÑúÎìúÎûÄ? Î∞∞Ïó¥Ïùò Í∏∞Ï°¥ ÏöîÏÜåÎ•º ÏÇ≠Ï†ú ÎòêÎäî ÍµêÏ≤¥ÌïòÍ±∞ÎÇò ÏÉà ÏöîÏÜåÎ•º Ï∂îÍ∞ÄÌïòÏó¨ Î∞∞Ïó¥Ïùò ÎÇ¥Ïö©ÏùÑ Î≥ÄÍ≤Ω -->
        <button class="allRemove" @click="allRemove(index),list.splice(index);">
            <i class="far fa-trash-alt">Ï†ÑÏ≤¥ ÏÇ≠Ï†úÎã§!</i>
        </button>
    </div>

    <script>
        
        // Î°úÏª¨ Ïä§ÌÜ†Î¶¨ÏßÄÎ•º Î≥ÄÏàòÎ°ú ÏÑ†Ïñ∏
        var STORAGE_KEY = 'vue3-todo-localStorage'
        // Î∞∞Ïó¥ÏùÑ fetch Ìï®ÏàòÎ•º ÌÜµÌï¥ÏÑú list ÏÑ†Ïñ∏ÌõÑ JSON ÌòïÏãùÏúºÎ°ú localStorage.getItem Î™ÖÎ†πÏñ¥Î•º ÌÜµÌï¥ÏÑú Í∞ÄÏ†∏Ïò® Ïù¥ÌõÑ list Î°ú Î¶¨ÌÑ¥
        var listStorage = {
            fetch() {
                var list = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
                console.log("Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄ Î°úÎìú")
                return list;
            },
            // save Ìï®ÏàòÎ•º ÌÜµÌï¥ÏÑú Î¶¨ÌÑ¥Î∞õÏùÄ list Î•º localStorage.setItem Î™ÖÎ†πÏñ¥Î•º ÌÜµÌï¥ÏÑú JSON ÌòïÏãùÏúºÎ°ú Ï†ÄÏû•
            save(list) {
                console.log("Îç∞Ïù¥ÌÑ∞ Î≥ÄÍ≤Ω Í∞êÏßÄ")
                localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
            }
        }
        
        
        // Vue3 CDN Î∞©ÏãùÏóêÏÑú import Î•º ÏÇ¨Ïö©ÌïòÍ∏∞ ÏúÑÌïòÏó¨ Î∞∞Ïó¥ Íµ¨Ï°∞Ïùò const ÏÉÅÏàòÎì§Î°ú ÏÑ†Ïñ∏ÌïòÏó¨ Í∞ÅÍ∞ÅÏùò Í∏∞Îä•Ïù¥ ÏûëÎèôÌïòÎèÑÎ°ù import
        const { createApp, computed, defineComponent, ref, reactive, watch } = Vue

        // createApp ÏùÑ ÌÜµÌï¥ÏÑú Vue app ÏÉùÏÑ±
        var app = createApp(defineComponent({
            setup() {
                // ÏàòÏ†ïÏ§ëÏù∏ index Î≥ÄÏàòÎ•º ÏÉùÏÑ±Ìï©ÎãàÎã§.
                // editingWork : ÏàòÏ†ïÏ§ëÏù∏ Îç∞Ïù¥ÌÑ∞Ïùò index Î≥ÄÏàò ÏÉùÏÑ±
                const editingWork = reactive({
                    index: -1,
                    isEdit: false,
                    attribute: '',
                })

                // ref : Î∑∞ ÌÖúÌîåÎ¶øÏùò DOM ÎòêÎäî Ïª¥Ìè¨ÎÑåÌä∏Î•º Í∞ÄÎ¶¨ÌÇ§Îäî ÏÜçÏÑ± -> reactive reference Î∞òÏùëÌòï Îç∞Ïù¥ÌÑ∞Î•º ÏùòÎØ∏Î°ú Î≥ÄÍ≤Ω
                const inputWork = ref('') // Îç∞Ïù¥ÌÑ∞ Ï∂îÍ∞Ä
                const newId = ref(0) // Îç∞Ïù¥ÌÑ∞Ïùò ID
                const filter = ref('all') // Îç∞Ïù¥ÌÑ∞Ïùò ÌïÑÌÑ∞
                const list = ref(listStorage.fetch()) // Îç∞Ïù¥ÌÑ∞Î•º Îã¥ÏïÑÎëêÎäî Î∞∞Ïó¥
                const remain = computed(() => list.value.filter(work => !work.complete).length) // work.complete Ïùò Í∏∏Ïù¥Î•º ÌÜµÌï¥ÏÑú ÎÇ®ÏùÄ Ìï† Ïùº Í∞ØÏàò ÌëúÏãú
                const listFilter = computed(() => { // computed Î•º ÌÜµÌï¥ÏÑú listFilter, if all, Í∑∏ Ïô∏ Ï°∞Í±¥Ïóê Îî∞ÎùºÏÑú undone / complete
                    if (filter.value == 'all') {
                        return list.value
                    } else if (filter.value == 'undone') {
                        return list.value.filter(work => !work.complete)
                    } else if (filter.value == 'complete') {
                        return list.value.filter(work => work.complete)
                    }
                    return list.value // Í∑∏ ÌõÑ list Ïùò value Î°ú Î¶¨ÌÑ¥
                })

                // Add Î≤ÑÌäºÏùÑ ÎàÑÎ•¥Î©¥ ÏûëÎèôÌïòÎäî Î©îÏÑúÎìú, new Date Î•º ÌÜµÌï¥ÏÑú ÌòÑÏû¨ ÏãúÍ∞ÑÏùÑ todate Î°ú Î≥ÄÏàò ÏÑ†Ïñ∏
                // list.value Ïùò concat / filter Í∞ôÏùÄ Î¶¨Ïä§Ìä∏ Î†åÎçîÎßÅÏùÑ ÏùòÎØ∏
                // Í∞Å Îç∞Ïù¥ÌÑ∞Ïùò ÏùòÎØ∏Îäî Îã§ÏùåÍ≥º Í∞ôÏùå
                const addWork = () => {
                    if (inputWork.value) {
                        let todate = new Date(+new Date() + 3240 * 10000).toISOString().replace("T", " ").replace(/\..*/, '');
                        list.value = list.value.concat({
                            id: newId.value++, // ÏÉàÎ°úÏö¥ Îç∞Ïù¥ÌÑ∞Ïùò id Îäî newId Ïùò value Í∞Ä ÏàúÏ∞®Ï†ÅÏúºÎ°ú Ï¶ùÍ∞Ä
                            attribute: inputWork.value, // Í∞ùÏ≤¥Í∞Ä Îã¥Í≥†ÏûàÎäî ÎÇ¥Ïö©
                            complete: false, // Í∞ùÏ≤¥Í∞Ä ÏÑ±Í≥µÌñàÎäîÏßÄ complete Ï°∞Í±¥ÏùÑ true/false Ï°∞Í±¥ÏùÑ ÌÜµÌïòÏó¨ Î∂ÑÎ¶¨
                            create: todate // ÏÉùÏÑ± ÏãúÍ∞Ñ
                        });
                    }
                    // input ÌïòÎäî ÏàúÍ∞Ñ box ÏïàÏóê ÏûàÎäî Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÇ¨ÎùºÏßÄÍ≤å Ìï®
                    inputWork.value = '';
                }

                // const complete = (work) => {
                //     work.complete = !work.complete;
                // }

                // list Î•º Î≥ÄÍ≤ΩÌï† ÎïåÎäî Vue2 ÏôÄÎäî Îã¨Î¶¨ list Ï†ÑÏ≤¥Î•º ÏÉàÎ°úÏö¥ list Î°ú ÎåÄÏ≤¥
                // done & remove Ìï®Ïàò

                // Í∞ùÏ≤¥Ïùò index Ï£ºÏÜåÍ∞íÏùÑ Ï∞æÏïÑÏÑú complte ÏÉÅÌÉúÎ•º Î≥ÄÍ≤ΩÌïú Ïù¥ÌõÑÏóê work Î°ú Î¶¨ÌÑ¥
                const done = (index) => {
                    // work.complete = !work.complete;
                    list.value = list.value.map((work, i) => {
                        if (i === index) work.complete = !work.complete;
                        return work
                    })
                }

                // Í∞ùÏ≤¥Ïùò index Ï£ºÏÜåÍ∞íÏùÑ Ï∞æÏïÑÏÑú filter Î•º ÌÜµÌï¥ÏÑú ÎìúÎü¨ÎÉÑ -> ÏÇ≠Ï†ú
                const remove = (index) => {
                    list.value = list.value.filter((_, i) => i !== index)
                }

                // ÏàòÏ†ïÎêòÍ≥† ÏûàÎäî Í∞ùÏ≤¥Î•º editingWork ÎùºÎäî ÏÉÅÌÉúÎ•º Í∞ÄÏßÄÍ≥† ÏûàÎäî index, attribute, isEdit Î°ú ÏÑ†Ïñ∏
                // index Î•º ÌÜµÌïòÏó¨ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÑ†ÌÉùÎêòÍ≥†, attribute Î•º ÌÜµÌïòÏó¨ Ìï¥Îãπ Îç∞Ïù¥ÌÑ∞Í∞Ä ÏÉÅÎã® Ïù∏ÌíãÎ∞ïÏä§Î°ú, isEdit Î•º ÌÜµÌï¥ ÏàòÏ†ïÏ§ëÏù∏ÏßÄ ÌôïÏù∏
                const setEditState = (index, work) => {
                    editingWork.index = index
                    editingWork.attribute = work.attribute
                    editingWork.isEdit = work.isEdit
                }

                // ÏàòÏ†ï Î≤ÑÌäºÏùÑ ÎàÑÎ•¥Î©¥ isEdit Í∞Ä true Î°ú Î≥ÄÌôòÌïòÎ©¥ÏÑú ÌòÑÏû¨ Îç∞Ïù¥ÌÑ∞Í∞Ä -> ÏàòÏ†ï Î∞ïÏä§ Îç∞Ïù¥ÌÑ∞Î°ú -> Í∑∏ ÌõÑÏóê setEditState Î•º ÌÜµÌïòÏó¨ Î≥ÄÍ≤Ω ÏûëÏóÖ ÏãúÏûë
                const startEdit = (index) => {
                    list.value = list.value.map((work, i) => {
                        if (i === index) {
                            work.isEdit = true
                            work.orgAttribute = work.attribute
                            setEditState(index, work)
                        }
                        return work
                    })
                }
                
                // isEdit Í∞Ä false Î°ú Î≥ÄÌôòÌïòÍ≥† ÏïÑÎ¨¥ÏùºÎèÑ ÏùºÏñ¥ÎÇòÏßÄ ÏïäÏùå, ÏïÑÎûò Î©îÏÑúÎìúÏôÄ Ï∞®Ïù¥Ï†êÏùÄ work.orgAttribute
                const cancelEdit = (index) => {
                    list.value = list.value.map((work, i) => {
                        if (i === index) {
                            work.isEdit = false
                            work.attribute = work.orgAttribute
                            setEditState(index, work)
                        }
                        return work
                    })
                }

                // Ï¶â ÌòÑÏû¨ Îç∞Ïù¥ÌÑ∞Ïù∏ work Í∞Ä ÏïÑÎãå edtingWork Ïùò Îç∞Ïù¥ÌÑ∞Í∞Ä Ï¶â work Îç∞Ïù¥ÌÑ∞Î°ú Î≥ÄÌôòÎêòÎ©¥ÏÑú Ï†ÄÏû•ÏÜåÏóê Ï†ÄÏû•Îê®
                const completeEdit = (index) => {
                    list.value = list.value.map((work, i) => {
                        if (i === index) {
                            work.isEdit = false
                            work.attribute = editingWork.attribute
                            setEditState(index, work)
                        }
                        return work
                    })
                }

                // Ï†ÑÏ≤¥ ÏÇ≠Ï†ú Î≤ÑÌäºÏùÑ ÎàÑÎ•¥Î©¥ ÏãúÏûëÌïòÎäî Î©îÏÑúÎìú, Î°úÏª¨Ïä§ÌÜ†Î¶¨ÏßÄÎ•º ÌÅ¥Î¶¨Ïñ¥ÌïòÍ≥† newId Ïùò Í∞íÏùÑ 0 ÏúºÎ°ú Ï¥àÍ∏∞Ìôî
                const allRemove = (index) => {
                    localStorage.clear();
                    id: newId.value = 0;
                }

                // watch Î•º ÌÜµÌïòÏó¨ Îç∞Ïù¥ÌÑ∞Í∞Ä Ïã§ÏßàÏ†ÅÏúºÎ°ú Î≥ÄÍ≤ΩÎêòÎäîÏßÄ ÌôïÏù∏
                // Vue3 ÏóêÏÑú Í∏∞Î≥∏Ï†ÅÏúºÎ°ú Swallow Î∞©ÏãùÏúºÎ°ú Íµ¨ÌòÑ, Î¶¨Ïä§Ìä∏Ïóê Îç∞Ïù¥ÌÑ∞Í∞Ä Ï∂îÍ∞ÄÎêòÏñ¥ÎèÑ Î≥ÄÏàòÏùò Î©îÎ™®Î¶¨Ïóê Î≥ÄÍ≤ΩÏù¥ Í∞ÄÌï¥ÏßÄÏßÄ ÏïäÏïÑÏÑú watch ÌåêÎã® Î∂àÍ∞Ä
                // deep ÏòµÏÖòÏùÑ ÌÜµÌï¥ÏÑú Îç∞Ïù¥ÌÑ∞Ïóê Î≥ÄÌôîÍ∞Ä ÏûàÏóàÎäîÏßÄ ÌôïÏù∏
                watch(() => list.value, (list) => {
                    listStorage.save(list);
                } // deep: true, handler ÏôÄ deep ÏùÄ Í∞ôÏùÄ depth
                  // Vue2 ÏóêÏÑú object Î∞è array Ïùò Í∞í Ï∂îÏ†Å(observation) Î∂àÏôÑÏ†ÑÌïòÏó¨ Vue3 Ìè¨Îß∑ÏúºÎ°ú ÏûëÏÑ±ÎêòÎ©∞ deep ÏÇ≠Ï†ú
                )

                return {
                    editingWork, // ÏàòÏ†ïÏ§ëÏù∏ Îç∞Ïù¥ÌÑ∞
                    inputWork, // Îç∞Ïù¥ÌÑ∞ inputBox
                    newId, // Îç∞Ïù¥ÌÑ∞Ïùò Id
                    filter, // Îç∞Ïù¥ÌÑ∞Ïùò ÏÉÅÌÉú
                    list, // Îç∞Ïù¥ÌÑ∞Í∞Ä Îã¥Í∏¥ Î∞∞Ïó¥
                    remain, // Îç∞Ïù¥ÌÑ∞Ïùò ÏÉÅÌÉúÏóê Îî∞ÎùºÏÑú Í∞ØÏàòÎ•º Íµ¨Î∂Ñ
                    listFilter, // Îç∞Ïù¥ÌÑ∞Ïùò ÏÉÅÌÉúÏóê Îî∞ÎùºÏÑú Î¶¨Ïä§Ìä∏Î•º Íµ¨Î∂Ñ
                    addWork, // Îç∞Ïù¥ÌÑ∞ ÏÇΩÏûÖ
                    done, // Îç∞Ïù¥ÌÑ∞Ïùò ÏÉÅÌÉú, done
                    remove, // Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú
                    startEdit, // ÏàòÏ†ï ÏãúÏûëÍ≥º View Î≥ÄÌôî
                    cancelEdit, // ÏàòÏ†ï Ï∑®ÏÜå
                    completeEdit, // ÏàòÏ†ï Îç∞Ïù¥ÌÑ∞ ÏÇΩÏûÖ
                    allRemove, // Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú
                }
            }
        }))

        app.mount('#app') // Vue3 app Ïó∞Í≤∞

    </script>
</body>

</html>